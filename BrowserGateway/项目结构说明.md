# BrowserGateway 项目结构说明

## 已创建的基础结构

### ✅ 1. 主应用类
- `BrowserGatewayApplication.java` - Spring Boot 主应用类，启用定时任务

### ✅ 2. 常量类（common 包）
- `Code.java` - 响应码常量
- `Constant.java` - 系统常量定义（插件状态、TCP 类型等）
- `ID.java` - TLV 字段 ID 常量（待完善）

### ✅ 3. 配置类（config 包）
- `Config.java` - 综合业务配置（路径、端口、上报等）
- `ApplicationConfig.java` - 应用基础配置
- `ChromeConfig.java` - Chrome 浏览器配置
- `TcpConfig.java` - TCP 服务配置
- `WebsocketConfig.java` - WebSocket 服务配置
- `ReportConfig.java` - 上报相关配置
- `DataTrackerConfig.java` - 数据统计配置
- `SchedulingConfig.java` - 定时任务配置

### ✅ 4. 实体类（entity 包）
- `CommonResult.java` - 统一响应结果封装
- `ResultCode.java` - 业务错误码枚举
- `BaseResponse.java` - 基础响应类
- `request/` - 请求实体
  - `InitBrowserRequest.java` - 初始化浏览器请求
  - `DeleteUserDataRequest.java` - 删除用户数据请求
  - `LoadExtensionRequest.java` - 加载扩展请求
- `response/` - 响应实体
  - `DeleteUserDataResponse.java` - 删除用户数据响应
  - `LoadExtensionResponse.java` - 加载扩展响应
- `plugin/` - 插件相关实体
  - `PluginActive.java` - 插件当前状态

### ✅ 5. 异常处理（exception 包）
- `GlobalExceptionHandle.java` - 全局异常处理器

### ✅ 6. REST API（api 包）
- `ChromeApi.java` - 浏览器管理 API
  - `POST /browsergw/browser/preOpen` - 预打开浏览器实例
  - `DELETE /browsergw/browser/userdata/delete` - 删除用户数据
- `ExtensionManageApi.java` - 扩展管理 API
  - `POST /browsergw/extension/load` - 加载扩展
  - `GET /browsergw/extension/pluginInfo` - 获取插件信息

### ✅ 7. 配置文件（resources 包）
- `application.yaml` - 主配置文件
- `microservice.yaml` - ServiceComb 微服务配置

## 待创建的包结构

根据设计文档，还需要创建以下包和类：

### service 包（业务服务）
- `IChromeSet.java` - 浏览器实例管理接口
- `IRemote.java` - 远程服务接口
- `IFileStorage.java` - 文件存储接口
- `IPluginManage.java` - 插件管理接口
- `IAlarm.java` - 告警服务接口
- `ICse.java` - CSE 服务接口
- `impl/` - 服务实现类
  - `ChromeSetImpl.java`
  - `RemoteImpl.java`
  - `FileStorageServiceImpl.java`
  - `PluginManageImpl.java`
  - `AlarmServiceImpl.java`
  - `CseImpl.java`
  - `UserChrome.java`
  - `UserData.java`
  - `HWCallbackImpl.java`
  - 等

### entity 包（待完善）
- `alarm/` - 告警相关实体
  - `AlarmEvent.java`
  - `AlarmResponseParam.java`
  - `DataParam.java`
- `browser/` - 浏览器相关实体
  - `ChromeRecordConfig.java`
  - `RouteAppConfig.java`
  - `UrlConfig.java`
- `enums/` - 枚举类
  - `AlarmEnum.java`
  - `BrowserStatus.java`
  - `RecordModeEnum.java`
- `operate/` - 操作相关实体
  - `Session.java`
  - `Traffic.java`

### util 包（工具类）
- `HttpUtil.java` - HTTP 请求工具
- `ZstdUtil.java` - Zstd 压缩工具
- `UserdataSlimmer.java` - 用户数据脱敏工具
- `UserIdUtil.java` - 用户 ID 工具
- `DateTimeUtil.java` - 日期时间工具
- `TimeUtil.java` - 时间工具
- `AuditLogUtil.java` - 审计日志工具
- `DeployUtil.java` - 部署工具
- `GzipUtil.java` - Gzip 工具
- `encode/` - TLV 编解码工具
  - `Ack.java`
  - `LoginResponse.java`
  - `Message.java`
  - `Tlv.java`
  - `TlvCodec.java`
  - `TlvDecoder.java`
  - `TlvEncoder.java`
  - `TlvField.java`
  - `TlvTag.java`

### tcpserver 包（TCP 服务器）
- `AbstractTcpServer.java` - TCP 服务器抽象类
- `Client.java` - 客户端
- `ClientSet.java` - 客户端集合
- `DataSizeTracker.java` - 数据大小跟踪器
- `control/` - 控制流服务器
  - `ControlClientSet.java`
  - `ControlTcpServer.java`
  - `ControlTcpServerHandler.java`
  - `ControlTlvServer.java`
- `media/` - 媒体流服务器
  - `MediaClientSet.java`
  - `MediaTcpServer.java`
  - `MediaTcpServerHandle.java`
  - `MediaTlvServer.java`
- `cert/` - 证书管理
  - `CertInfo.java`
  - `ExCertInfo.java`
  - `SubscribeCert.java`

### websocket 包（WebSocket 服务）
- `ServerEndpointExporter.java` - WebSocket 端点导出器
- `SessionSet.java` - 会话集合
- `SocketKeyConst.java` - Socket 键常量
- `media/` - 媒体流 WebSocket
  - `AudioResponse.java`
  - `MediaParam.java`
  - `MediaSessionManager.java`
  - `MediaStreamProcessor.java`
  - `MediaStreamSocketServer.java`
  - `VideoResponse.java`
  - `ffmpeg/` - FFmpeg 相关
  - `webcodecs/` - WebCodecs 相关
- `extension/` - 插件代理 WebSocket
  - `MuenProxySocketServer.java`
  - `MuenSessionManager.java`

### scheduled 包（定时任务）
- `BrowserCheckTask.java` - 浏览器检查任务
- `BrowserCloserTask.java` - 浏览器关闭任务
- `BrowserProxyLogDump.java` - 日志轮转任务
- `HealthCheckTask.java` - 健康检查任务
- `ServiceReporter.java` - 服务上报任务
- `ServiceStatusRefresherTask.java` - 服务状态刷新任务
- `TcpChannelMonitor.java` - TCP 连接监控任务

## 下一步工作

1. **创建 Service 接口和实现** - 实现业务逻辑层
2. **创建 TLV 编解码工具** - 实现 TCP 协议编解码
3. **创建 TCP 服务器** - 实现控制流和媒体流服务器
4. **创建 WebSocket 服务** - 实现媒体流转发和插件代理
5. **创建定时任务** - 实现健康检查、实例清理等任务
6. **创建工具类** - 实现 HTTP、压缩、脱敏等工具

## 编译和运行

```bash
# 编译项目
mvn clean compile

# 运行测试
mvn test

# 打包
mvn clean package
```

## 注意事项

1. **CSP SDK 依赖**：项目依赖华为内部 CSP SDK，需要配置内网 Maven 仓库
2. **browser-module-sdk-api.jar**：需要将 JAR 文件放到 `src/main/resources/lib/` 目录下
3. **配置文件**：根据实际环境修改 `application.yaml` 中的配置项
