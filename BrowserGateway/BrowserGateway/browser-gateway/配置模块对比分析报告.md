# BrowserGatewayå­˜é‡ä»£ç ä¸é‡å†™ä»£ç é…ç½®åŠŸèƒ½å¯¹æ¯”æŠ¥å‘Š

## ä¸€ã€æŠ¥å‘Šæ¦‚è¿°

æœ¬æŠ¥å‘Šå¯¹æ¯”åˆ†æå­˜é‡ä»£ç å’Œé‡å†™ä»£ç ä¸­çš„é…ç½®ç±»å®ç°æƒ…å†µï¼Œè¯†åˆ«åŠŸèƒ½ç¼ºå¤±ï¼Œå¹¶æä¾›è¡¥å……æ–¹æ¡ˆã€‚

**å­˜é‡ä»£ç è·¯å¾„**ï¼š`D:\Code\äº‘æ‰‹æœº\BrowserGateway\browser-gateway\src\main\java\com\huawei\browsergateway\config`

**é‡å†™ä»£ç è·¯å¾„**ï¼š`D:\Code\äº‘æ‰‹æœº\SBG\BrowserGateway\BrowserGateway\browser-gateway\src\main\java\com\huawei\browsergateway\config`

---

## äºŒã€å­˜é‡ä»£ç é…ç½®ç±»æ¸…å•

### 2.1 é…ç½®ç±»æ€»è§ˆ

| é…ç½®ç±»å | è¡Œæ•° | åŠŸèƒ½æè¿° | ä¾èµ–æ³¨å…¥ | ä¾èµ–çš„é…ç½®ç±» |
|---------|------|---------|---------|-------------|
| Config.java | 99 | ä¸»é…ç½®ç±»ã€è·¯å¾„ç®¡ç† | @Value, @Resource | ReportConfig, WebsocketConfig, TcpConfig, ChromeConfig |
| ApplicationConfig.java | 45 | é…ç½®æ–‡ä»¶åŠ è½½ | @Bean | æ—  |
| ChromeConfig.java | 25 | Chromeæµè§ˆå™¨é…ç½® | @Value | æ—  |
| ReportConfig.java | 32 | æœåŠ¡ä¸ŠæŠ¥é…ç½® | @Value | æ—  |
| WebsocketConfig.java | 25 | WebSocketé…ç½® | @Value | æ—  |
| TcpConfig.java | 31 | TCPåè®®é…ç½® | @Value | æ—  |
| DataTrackerConfig.java | 42 | æ•°æ®è¿½è¸ªBeanå®šä¹‰ | @Bean, @Autowired | IRemote |
| SchedulingConfig.java | 23 | å®šæ—¶ä»»åŠ¡å¯ç”¨ | @EnableScheduling | æ—  |

### 2.2 è¯¦ç»†é…ç½®ç±»åˆ†æ

#### 2.2.1 Config.java - ä¸»é…ç½®ç±»

**æ ¸å¿ƒåŠŸèƒ½**ï¼š
1. è·¯å¾„å¸¸é‡å®šä¹‰
2. è·¯å¾„è®¿é—®æ–¹æ³•
3. é…ç½®èšåˆ
4. ä¸šåŠ¡é€»è¾‘æ‹¼æ¥

**èµ„æºé…ç½®**ï¼š
```java
@Value("${browsergw.workspace}")
private String workspace;

@Value("${browsergw.context-limit:40}")
private int contextLimit;

@Value("${server.address}")
private String address;

@Value("${server.port}")
private Integer port;
```

**è·¯å¾„å¸¸é‡**ï¼š
```java
public static final String USER_DATA_PATH = "userdata";
public static final String BASE_DATA_PATH = "basedata";
public static final String LOCAL_STORAGE_PATH = "storage";
public static final String TMP_PATH = "tmp";
public static final String EXTENSION_PATH = "extension";
public static final String KEY = "keys";
public static final String TOUCH = "touch";
public static final String RECORD = "record";
public static final String JAR = "jar";
```

**é…ç½®èšåˆ**ï¼š
```java
@Resource
private ReportConfig report;

@Resource
private WebsocketConfig websocket;

@Resource
private TcpConfig tcp;

@Resource
private ChromeConfig chrome;
```

**æ ¸å¿ƒæ–¹æ³•**ï¼š
```java
// è·¯å¾„ç®¡ç†æ–¹æ³•
public String getUserDataPath() { ... }
public String getLocalStoragePath() { ... }
public String getBaseDataPath() { ... }
public String getTmpPath() { ... }
public String getExtensionPath() { ... }
public String getKeyExtensionPath() { ... }
public String getTouchExtensionPath() { ... }
public String getRecordExtensionPath() { ... }
public String getJarDirPath() { ... }

// ä¸šåŠ¡é€»è¾‘æ–¹æ³•
public String getCodecMode()
public String getRecordExtensionPage()
public String getSelfAddr()
public String getInnerMediaEndpoint()
```

#### 2.2.2 ApplicationConfig.java - é…ç½®æ–‡ä»¶åŠ è½½

**åŠŸèƒ½**ï¼šæ ¹æ®æ“ä½œç³»ç»ŸåŠ¨æ€åŠ è½½é…ç½®æ–‡ä»¶

```java
@Configuration
public class ApplicationConfig {
    @Bean
    public static PropertySourcesPlaceholderConfigurer propertySourcesPlaceholderConfigurer() {
        String osName = System.getProperty("os.name").toLowerCase();
        String jarPath = new File(ApplicationConfig.class.getProtectionDomain()
                .getCodeSource().getLocation().getPath()).getParent();

        String ap;
        if (osName.contains("win")) {
            ap = Paths.get(jarPath, "..", "src", "main", "resources")
                      .resolve("application.yaml").toString();
        } else {
            ap = Paths.get(jarPath, "conf").resolve("application.yaml").toString();
        }

        Resource fileResource = new FileSystemResource(ap);
        YamlPropertiesFactoryBean yaml = new YamlPropertiesFactoryBean();
        yaml.setResources(new FileSystemResource(ap));
        Properties properties = yaml.getObject();

        PropertySourcesPlaceholderConfigurer configurer = new PropertySourcesPlaceholderConfigurer();
        configurer.setLocation(fileResource);
        configurer.setProperties(properties);
        return configurer;
    }
}
```

#### 2.2.3 ChromeConfig.java - Chromeé…ç½®

**é…ç½®é¡¹**ï¼š
```java
@Value("${browsergw.chrome.record-mode}")
private Integer recordMode;

@Value("${browsergw.chrome.headless}")
private boolean headless = false;

@Value("${browsergw.chrome.record-extension-id}")
private String recordExtensionId;

@Value("${browsergw.chrome.endpoint}")
private String endpoint;

@Value("${browsergw.chrome.executable-path}")
private String executablePath;
```

#### 2.2.4 ReportConfig.java - æœåŠ¡ä¸ŠæŠ¥é…ç½®

**é…ç½®é¡¹**ï¼š
```java
@Value("${browsergw.report.control-endpoint}")
private String controlEndpoint;

@Value("#{'${browsergw.report.control-tls-endpoint}'.empty ? '41.203.73.4:30011' : '${browsergw.report.control-tls-endpoint}'}")
private String controlTlsEndpoint;

@Value("${browsergw.report.media-endpoint}")
private String mediaEndpoint;

@Value("#{'${browsergw.report.media-tls-endpoint}'.empty ? '41.203.73.4:30013' : '${browsergw.report.media-tls-endpoint}'}")
private String mediaTlsEndpoint;

@Value("${browsergw.report.cap}")
private Integer cap;

@Value("${browsergw.report.ttl}")
private Integer ttl;

@Value("${browsergw.report.chain-endpoints}")
private String chainEndpoints;
```

#### 2.2.5 WebsocketConfig.java - WebSocketé…ç½®

**é…ç½®é¡¹**ï¼š
```java
@Value("${browsergw.websocket.media-port}")
private Integer mediaPort;

@Value("${browsergw.websocket.muen-port}")
private Integer muenPort;

@Value("${browsergw.websocket.boss}")
private Integer boss;

@Value("${browsergw.websocket.worker}")
private Integer worker;

@Value("${browsergw.websocket.heartbeat-ttl}")
private Long heartbeatTtl;
```

#### 2.2.6 TcpConfig.java - TCPé…ç½®

**é…ç½®é¡¹**ï¼š
```java
@Value("${browsergw.tcp.address}")
private String address;

@Value("${browsergw.tcp.control-port}")
private Integer controlPort;

@Value("${browsergw.tcp.media-port}")
private Integer mediaPort;

@Value("${browsergw.tcp.control-tls-port}")
private Integer controlTlsPort;

@Value("${browsergw.tcp.media-tls-port}")
private Integer mediaTlsPort;

@Value("${browsergw.tcp.heartbeat-ttl}")
private long heartbeatTtl;

@Value("${browsergw.tcp.enable-http}")
private boolean enableHttp;
```

#### 2.2.7 DataTrackerConfig.java - æ•°æ®è¿½è¸ªé…ç½®

**Beanå®šä¹‰**ï¼š
```java
@Configuration
public class DataTrackerConfig {

    @Autowired
    private IRemote remote;

    @Bean
    public DataSizeTracker mediaDataSizeTracker() {
        return new DataSizeTracker(remote, "media");
    }

    @Bean
    public DataSizeTracker controlDataSizeTracker() {
        return new DataSizeTracker(remote, "control");
    }
}
```

#### 2.2.8 SchedulingConfig.java - å®šæ—¶ä»»åŠ¡é…ç½®

```java
@Configuration
@EnableScheduling
public class SchedulingConfig {
    // å®šæ—¶ä»»åŠ¡å¯ç”¨é…ç½®
}
```

---

## ä¸‰ã€é‡å†™ä»£ç é…ç½®ç±»æ¸…å•

### 3.1 é…ç½®ç±»æ€»è§ˆ

| é…ç½®ç±»å | è¡Œæ•° | åŠŸèƒ½æè¿° | é…ç½®æ–¹å¼ |
|---------|------|---------|---------|
| ApplicationConfig.java | 12 | åº”ç”¨é…ç½®ï¼ˆç©ºå®ç°ï¼‰ | @Configuration |
| FrameworkStartupConfig.java | 51 | æ¡†æ¶å¯åŠ¨é…ç½® | @Component + @Autowired |
| WebSocketConfig.java | 23 | WebSocketç«¯ç‚¹æ³¨å†Œ | @Bean |
| AdapterConfig.java | 35 | é€‚é…å™¨é…ç½® | @ConfigurationProperties |
| å­˜é‡ä»£ç ä¸­çš„Configç±» | âŒ ä¸å­˜åœ¨ | - | - |
| ChromeConfig.java | âŒ ä¸å­˜åœ¨ | - | - |
| ReportConfig.java | âŒ ä¸å­˜åœ¨ | - | - |
| TcpConfig.java | âŒ ä¸å­˜åœ¨ | - | - |
| DataTrackerConfig.java | âŒ ä¸å­˜åœ¨ | - | - |
| SchedulingConfig.java | âŒ éƒ¨åˆ†å®ç° | - | - |

### 3.2 è¯¦ç»†é…ç½®ç±»åˆ†æ

#### 3.2.1 ApplicationConfig.java

```java
@Configuration
public class ApplicationConfig {
    // TODO: æ·»åŠ åº”ç”¨ç›¸å…³é…ç½®
}
```

**å¯¹æ¯”ç»“è®º**ï¼š
- âŒ **åŠŸèƒ½ç¼ºå¤±**ï¼šä¸å­˜é‡ä»£ç åŒåä½†åŠŸèƒ½å®Œå…¨ä¸åŒ
- âŒ æ— é…ç½®æ–‡ä»¶åŠ è½½é€»è¾‘
- âŒ æ— PropertySourcesPlaceholderConfigureré…ç½®

#### 3.2.2 FrameworkStartupConfig.java

```java
@Component
public class FrameworkStartupConfig implements ApplicationRunner {
    @Autowired(required = false)
    private FrameworkAdapter frameworkAdapter;

    @Override
    public void run(ApplicationArguments args) throws Exception {
        // å¯åŠ¨CSEæ¡†æ¶å’ŒOM SDK
        frameworkAdapter.start();
        frameworkAdapter.initializeOmSdK();
    }
}
```

**å¯¹æ¯”ç»“è®º**ï¼š
- âœ… **æ–°å¢åŠŸèƒ½**ï¼šé‡å†™ä»£ç ç‰¹æœ‰
- æ— å­˜é‡ä»£ç å¯¹åº”å®ç°

#### 3.2.3 WebSocketConfig.java

```java
@Configuration
public class WebSocketConfig {
    @Bean
    public ServerEndpointExporter serverEndpointExporter() {
        return new ServerEndpointExporter();
    }
}
```

**å¯¹æ¯”ç»“è®º**ï¼š
- âš ï¸ **åŠŸèƒ½å˜åŒ–**ï¼šä»…æœ‰WebSocketç«¯ç‚¹æ³¨å†ŒåŠŸèƒ½
- âŒ ç¼ºå°‘WebsocketConfigçš„å‚æ•°é…ç½®åŠŸèƒ½

#### 3.2.4 AdapterConfig.java

```java
@Data
@ConfigurationProperties(prefix = "adapter")
public class AdapterConfig {
    private Provider provider = new Provider();

    @Data
    public static class Provider {
        private AdapterProviderType type = AdapterProviderType.CSP_SDK;
        private boolean enableMock = false;
    }
}
```

**å¯¹æ¯”ç»“è®º**ï¼š
- âœ… **æ–°å¢åŠŸèƒ½**ï¼šé‡å†™ä»£ç ç‰¹æœ‰
- æ— å­˜é‡ä»£ç å¯¹åº”å®ç°

---

## å››ã€é…ç½®æ–‡ä»¶å†…å®¹å¯¹æ¯”

### 4.1 å­˜é‡ä»£ç é…ç½®é¡¹ï¼ˆä»Configç±»æå–ï¼‰

| é…ç½®é”® | é…ç½®é¡¹ | é»˜è®¤å€¼ | é‡å†™ä»£ç çŠ¶æ€ |
|-------|-------|--------|------------|
| browsergw.workspace | å·¥ä½œåŒºè·¯å¾„ | å¿…å¡« | âœ… æœ‰ |
| browsergw.context-limit | ä¸Šä¸‹æ–‡é™åˆ¶ | 40 | âš ï¸ æœªç¡®è®¤ |
| server.address | æœåŠ¡å™¨åœ°å€ | å¿…å¡« | âœ… æœ‰ |
| server.port | æœåŠ¡å™¨ç«¯å£ | å¿…å¡« | âœ… æœ‰ |

### 4.2 Chromeé…ç½®é¡¹

| é…ç½®é”® | é…ç½®é¡¹ | é»˜è®¤å€¼ | é‡å†™ä»£ç çŠ¶æ€ |
|-------|-------|--------|------------|
| browsergw.chrome.record-mode | å½•åˆ¶æ¨¡å¼ | å¿…å¡« | âœ… æœ‰ |
| browsergw.chrome.headless | æ— å¤´æ¨¡å¼ | false | âœ… æœ‰ |
| browsergw.chrome.record-extension-id | å½•åˆ¶æ‰©å±•ID | å¿…å¡« | âŒ ç¼ºå¤± |
| browsergw.chrome.endpoint | Chromeç«¯ç‚¹ | å¿…å¡« | âœ… æœ‰ |
| browsergw.chrome.executable-path | Chromeå¯æ‰§è¡Œè·¯å¾„ | å¿…å¡« | âœ… æœ‰ |
| browsergw.chrome.ttl | TTL | - | âš ï¸ æœªç¡®è®¤ |

### 4.3 Reporté…ç½®é¡¹

| é…ç½®é”® | é…ç½®é¡¹ | é»˜è®¤å€¼ | é‡å†™ä»£ç çŠ¶æ€ |
|-------|-------|--------|------------|
| browsergw.report.control-endpoint | æ§åˆ¶ç«¯ç‚¹ | å¿…å¡« | âœ… æœ‰ |
| browsergw.report.control-tls-endpoint | æ§åˆ¶TLSç«¯ç‚¹ | 41.203.73.4:30011 (SpEL) | âŒ ç¼ºå¤± |
| browsergw.report.media-endpoint | åª’ä½“ç«¯ç‚¹ | å¿…å¡« | âœ… æœ‰ |
| browsergw.report.media-tls-endpoint | åª’ä½“TLSç«¯ç‚¹ | 41.203.73.4:30013 (SpEL) | âŒ ç¼ºå¤± |
| browsergw.report.cap | æœåŠ¡å®¹é‡ | å¿…å¡« | âœ… æœ‰ |
| browsergw.report.ttl | ä¸ŠæŠ¥è¿‡æœŸæ—¶é—´ | å¿…å¡« | âœ… æœ‰ |
| browsergw.report.chain-endpoints | é“¾è·¯ç«¯ç‚¹ | å¿…å¡« | âœ… æœ‰ |
| browsergw.report.self-addr | è‡ªèº«åœ°å€ | - | âœ… æœ‰ |

### 4.4 Websocketé…ç½®é¡¹

| é…ç½®é”® | é…ç½®é¡¹ | é»˜è®¤å€¼ | é‡å†™ä»£ç çŠ¶æ€ |
|-------|-------|--------|------------|
| browsergw.websocket.media-port | åª’ä½“ç«¯å£ | å¿…å¡« | âœ… æœ‰ |
| browsergw.websocket.muen-port | Moonç«¯å£ | å¿…å¡« | âœ… æœ‰ |
| browsergw.websocket.boss | Bossçº¿ç¨‹æ•° | å¿…å¡« | âš ï¸ æœªç¡®è®¤ |
| browsergw.websocket.worker | Workerçº¿ç¨‹æ•° | å¿…å¡« | âš ï¸ æœªç¡®è®¤ |
| browsergw.websocket.heartbeat-ttl | å¿ƒè·³TTL | å¿…å¡« | âœ… æœ‰ |

### 4.5 Tcpé…ç½®é¡¹

| é…ç½®é”® | é…ç½®é¡¹ | é»˜è®¤å€¼ | é‡å†™ä»£ç çŠ¶æ€ |
|-------|-------|--------|------------|
| browsergw.tcp.address | TCPåœ°å€ | å¿…å¡« | âŒ ç¼ºå¤± |
| browsergw.tcp.control-port | æ§åˆ¶ç«¯å£ | å¿…å¡« | âœ… æœ‰ |
| browsergw.tcp.media-port | åª’ä½“ç«¯å£ | å¿…å¡« | âœ… æœ‰ |
| browsergw.tcp.control-tls-port | æ§åˆ¶TLSç«¯å£ | å¿…å¡« | âŒ ç¼ºå¤± |
| browsergw.tcp.media-tls-port | åª’ä½“TLSç«¯å£ | å¿…å¡« | âŒ ç¼ºå¤± |
| browsergw.tcp.heartbeat-ttl | å¿ƒè·³TTL | å¿…å¡« | âœ… æœ‰ |
| browsergw.tcp.enable-http | å¯ç”¨HTTP | false | âŒ ç¼ºå¤± |

### 4.6 é‡å†™ä»£ç æ–°å¢é…ç½®é¡¹

| é…ç½®é”® | é…ç½®é¡¹ | è¯´æ˜ |
|-------|-------|------|
| adapter.provider.type | é€‚é…å™¨ç±»å‹ | æ–°å¢ |
| adapter.provider.enable-mock | å¯ç”¨Mock | æ–°å¢ |
| browsergw.scheduled.check-browser-period | æµè§ˆå™¨æ£€æŸ¥å‘¨æœŸ | æ–°å¢ |
| browsergw.scheduled.close-browser-period | æµè§ˆå™¨å…³é—­å‘¨æœŸ | æ–°å¢ |
| browsergw.healthCheck.cpu-trigger-threshold | CPUè§¦å‘é˜ˆå€¼ | æ–°å¢ |
| browsergw.healthCheck.memory-trigger-threshold | å†…å­˜è§¦å‘é˜ˆå€¼ | æ–°å¢ |

---

## äº”ã€åŠŸèƒ½ç¼ºå¤±è¯¦ç»†åˆ†æ

### 5.1 æ ¸å¿ƒé…ç½®ç±»ç¼ºå¤±

#### 5.1.1 Configç±»ç¼ºå¤±ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰

**ç¼ºå¤±å†…å®¹**ï¼š
1. âœ… æ— ä¸»é…ç½®ç±»ä½œä¸ºé…ç½®èšåˆä¸­å¿ƒ
2. âŒ æ— è·¯å¾„å¸¸é‡å®šä¹‰ï¼ˆUSER_DATA_PATHç­‰ï¼‰
3. âŒ æ— è·¯å¾„è®¿é—®æ–¹æ³•ï¼ˆgetUserDataPath()ç­‰ï¼‰
4. âŒ æ— ä¸šåŠ¡é€»è¾‘æ‹¼æ¥æ–¹æ³•ï¼ˆgetCodecMode()ç­‰ï¼‰

**å½±å“èŒƒå›´**ï¼š
- PluginManageImplï¼šéœ€è¦æ‰©å±•è·¯å¾„
- ChromeSetImplï¼šéœ€è¦åª’ä½“ç«¯ç‚¹æ‹¼æ¥
- UserChromeï¼šéœ€è¦è·¯å¾„è®¿é—®

#### 5.1.2 ChromeConfigç±»ç¼ºå¤±ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰

**ç¼ºå¤±å†…å®¹**ï¼š
1. âŒ æ— ChromeConfigç±»
2. âŒ `browsergw.chrome.record-extension-id`é…ç½®é¡¹ç¼ºå¤±

**å½±å“èŒƒå›´**ï¼š
- å½•åˆ¶æ‰©å±•åŠŸèƒ½
- Chromeå¯åŠ¨é…ç½®

#### 5.1.3 ReportConfigç±»ç¼ºå¤±ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰

**ç¼ºå¤±å†…å®¹**ï¼š
1. âŒ æ— ReportConfigç±»
2. âŒ `browsergw.report.control-tls-endpoint`é…ç½®é¡¹ç¼ºå¤±
3. âŒ `browsergw.report.media-tls-endpoint`é…ç½®é¡¹ç¼ºå¤±

**å½±å“èŒƒå›´**ï¼š
- æœåŠ¡ä¸ŠæŠ¥åŠŸèƒ½
- TLSç«¯ç‚¹é…ç½®

#### 5.1.4 TcpConfigç±»ç¼ºå¤±ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰

**ç¼ºå¤±å†…å®¹**ï¼š
1. âŒ æ— TcpConfigç±»
2. âŒ `browsergw.tcp.address`é…ç½®é¡¹ç¼ºå¤±
3. âŒ `browsergw.tcp.control-tls-port`é…ç½®é¡¹ç¼ºå¤±
4. âŒ `browsergw.tcp.media-tls-port`é…ç½®é¡¹ç¼ºå¤±
5. âŒ `browsergw.tcp.enable-http`é…ç½®é¡¹ç¼ºå¤±

**å½±å“èŒƒå›´**ï¼š
- TCPæœåŠ¡é…ç½®
- HTTPåŠŸèƒ½å¼€å…³

#### 5.1.5 DataTrackerConfigç±»ç¼ºå¤±ï¼ˆä½ä¼˜å…ˆçº§ï¼‰

**ç¼ºå¤±å†…å®¹**ï¼š
1. âŒ æ— DataTrackerConfigç±»
2. âŒ æ— DataSizeTracker Beanå®šä¹‰

**å½±å“èŒƒå›´**ï¼š
- æ•°æ®è¿½è¸ªåŠŸèƒ½
- æµé‡ç»Ÿè®¡

#### 5.1.6 SchedulingConfigç±»ç¼ºå¤±ï¼ˆä½ä¼˜å…ˆçº§ï¼‰

**ç¼ºå¤±å†…å®¹**ï¼š
1. âŒ æ— SchedulingConfigç±»
2. âŒ æ— æ˜ç¡®çš„@EnableSchedulingé…ç½®

**å½±å“èŒƒå›´**ï¼š
- å®šæ—¶ä»»åŠ¡å¯ç”¨

---

## å…­ã€è¡¥å……æ–¹æ¡ˆ

### 6.1 Configç±»è¡¥å……æ–¹æ¡ˆ

#### 6.1.1 åˆ›å»ºæ–°çš„Configç±»

```java
package com.huawei.browsergateway.config;

import cn.hutool.core.io.FileUtil;
import com.huawei.browsergateway.entity.enums.RecordModeEnum;
import lombok.Data;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Configuration;
import org.springframework.stereotype.Component;

@Data
@Configuration
@Component
public class BrowserGatewayConfig {

    // ========== è·¯å¾„å¸¸é‡å®šä¹‰ ==========
    public static final String USER_DATA_PATH = "userdata";
    public static final String BASE_DATA_PATH = "basedata";
    public static final String LOCAL_STORAGE_PATH = "storage";
    public static final String TMP_PATH = "tmp";
    public static final String EXTENSION_PATH = "extension";
    public static final String KEY = "keys";
    public static final String TOUCH = "touch";
    public static final String RECORD = "record";
    public static final String JAR = "jar";

    // ========== åŸºç¡€é…ç½®æ³¨å…¥ ==========
    @Value("${browsergw.workspace:/opt/host}")
    private String workspace;

    @Value("${browsergw.context-limit:40}")
    private int contextLimit;

    @Value("${server.address}")
    private String address;

    @Value("${server.port}")
    private Integer port;

    // ========== è·¯å¾„ç®¡ç†æ–¹æ³• ==========
    public String getUserDataPath() {
        return FileUtil.file(workspace, USER_DATA_PATH).getAbsolutePath();
    }

    public String getLocalStoragePath() {
        return FileUtil.file(workspace, LOCAL_STORAGE_PATH).getAbsolutePath();
    }

    public String getBaseDataPath() {
        return FileUtil.file(workspace, BASE_DATA_PATH).getAbsolutePath();
    }

    public String getTmpPath() {
        return FileUtil.file(workspace, TMP_PATH).getAbsolutePath();
    }

    public String getExtensionPath() {
        return FileUtil.file(workspace, EXTENSION_PATH).getAbsolutePath();
    }

    public String getKeyExtensionPath() {
        return FileUtil.file(workspace, EXTENSION_PATH, KEY).getAbsolutePath();
    }

    public String getTouchExtensionPath() {
        return FileUtil.file(workspace, EXTENSION_PATH, TOUCH).getAbsolutePath();
    }

    public String getRecordExtensionPath() {
        return FileUtil.file(workspace, EXTENSION_PATH, RECORD).getAbsolutePath();
    }

    public String getJarDirPath() {
        return FileUtil.file(workspace, JAR).getAbsolutePath();
    }

    // ========== ä¸šåŠ¡é€»è¾‘æ‹¼æ¥æ–¹æ³• ==========
    public String getCodecMode() {
        // è¿™é‡Œéœ€è¦ä»é…ç½®ä¸­è·å–recordModeå¹¶è½¬æ¢
        // æš‚æ—¶è¿”å›é»˜è®¤å€¼
        return RecordModeEnum.getRecordNameByMode(0);
    }

    public String getRecordExtensionPage() {
        // ä»é…ç½®ä¸­è·å–recordExtensionId
        String recordExtensionId = "your-record-extension-id";  // éœ€è¦ä»é…ç½®æ³¨å…¥
        return String.format("chrome-extension://%s/offscreen.html", recordExtensionId);
    }

    public String getSelfAddr() {
        return this.address + ":" + this.port;
    }

    /**
     * è·å–å†…éƒ¨åª’ä½“ç«¯ç‚¹
     */
    public String getInnerMediaEndpoint() {
        // ä»é…ç½®ä¸­è·å–mediaPort
        int mediaPort = 8095;  // éœ€è¦ä»é…ç½®æ³¨å…¥
        return this.address + ":" + mediaPort;
    }
}
```

#### 6.1.2 ä¸ç°æœ‰é…ç½®ç±»é›†æˆ

åœ¨å…¶ä»–éœ€è¦è·¯å¾„è®¿é—®çš„åœ°æ–¹ï¼Œä½¿ç”¨`@Autowired BrowserGatewayConfig config`æ›¿ä»£ç›´æ¥ä½¿ç”¨`@Value`ã€‚

### 6.2 ChromeConfigç±»è¡¥å……æ–¹æ¡ˆ

```java
package com.huawei.browsergateway.config;

import lombok.Data;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Configuration;

@Data
@Configuration
public class ChromeConfig {

    @Value("${browsergw.chrome.record-mode}")
    private Integer recordMode;

    @Value("${browsergw.chrome.headless:false}")
    private boolean headless;

    @Value("${browsergw.chrome.record-extension-id}")
    private String recordExtensionId;

    @Value("${browsergw.chrome.endpoint}")
    private String endpoint;

    @Value("${browsergw.chrome.executable-path}")
    private String executablePath;
}
```

### 6.3 ReportConfigç±»è¡¥å……æ–¹æ¡ˆ

```java
package com.huawei.browsergateway.config;

import lombok.Data;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Configuration;

@Data
@Configuration
public class ReportConfig {

    @Value("${browsergw.report.control-endpoint}")
    private String controlEndpoint;

    @Value("#{'${browsergw.report.control-tls-endpoint}'.empty ? '41.203.73.4:30011' : '${browsergw.report.control-tls-endpoint}'}")
    private String controlTlsEndpoint;

    @Value("${browsergw.report.media-endpoint}")
    private String mediaEndpoint;

    @Value("#{'${browsergw.report.media-tls-endpoint}'.empty ? '41.203.73.4:30013' : '${browsergw.report.media-tls-endpoint}'}")
    private String mediaTlsEndpoint;

    @Value("${browsergw.report.cap}")
    private Integer cap;

    @Value("${browsergw.report.ttl}")
    private Integer ttl;

    @Value("${browsergw.report.chain-endpoints}")
    private String chainEndpoints;

    @Value("${browsergw.report.self-addr}")
    private String selfAddr;
}
```

### 6.4 TcpConfigç±»è¡¥å……æ–¹æ¡ˆ

```java
package com.huawei.browsergateway.config;

import lombok.Data;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Configuration;

@Data
@Configuration
public class TcpConfig {

    @Value("${browsergw.tcp.address}")
    private String address;

    @Value("${browsergw.tcp.control-port}")
    private Integer controlPort;

    @Value("${browsergw.tcp.media-port}")
    private Integer mediaPort;

    @Value("${browsergw.tcp.control-tls-port}")
    private Integer controlTlsPort;

    @Value("${browsergw.tcp.media-tls-port}")
    private Integer mediaTlsPort;

    @Value("${browsergw.tcp.heartbeat-ttl}")
    private long heartbeatTtl;

    @Value("${browsergw.tcp.enable-http:false}")
    private boolean enableHttp;
}
```

### 6.5 é…ç½®æ–‡ä»¶è¡¥å……æ–¹æ¡ˆ

åœ¨`application.yaml`ä¸­æ·»åŠ ç¼ºå¤±çš„é…ç½®é¡¹ï¼š

```yaml
browsergw:
  # Chromeé…ç½®
  chrome:
    record-mode: 0
    headless: false
    record-extension-id: your-record-extension-id
    endpoint: http://localhost:9515
    executable-path: /usr/bin/google-chrome

  # Reporté…ç½®
  report:
    control-endpoint: http://localhost:8080/control
    control-tls-endpoint: 41.203.73.4:30011
    media-endpoint: http://localhost:8080/media
    media-tls-endpoint: 41.203.73.4:30013
    cap: 300
    ttl: 120
    chain-endpoints: "http://node1:port,http://node2:port"
    self-addr: ${server.address}:${server.port}

  # TCPé…ç½®
  tcp:
    address: 0.0.0.0
    control-port: 10010
    media-port: 10020
    control-tls-port: 10011
    media-tls-port: 10021
    heartbeat-ttl: 300000
    enable-http: false

  # WebSocketé…ç½®
  websocket:
    boss: 1
    worker: 8
```

### 6.6 DataTrackerConfigç±»è¡¥å……æ–¹æ¡ˆï¼ˆå¦‚éœ€è¦ï¼‰

```java
package com.huawei.browsergateway.config;

import com.huawei.browsergateway.service.IRemote;
import com.huawei.browsergateway.service.impl.DataSizeTracker;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class DataTrackerConfig {

    @Autowired
    private IRemote remote;

    @Bean
    public DataSizeTracker mediaDataSizeTracker() {
        return new DataSizeTracker(remote, "media");
    }

    @Bean
    public DataSizeTracker controlDataSizeTracker() {
        return new DataSizeTracker(remote, "control");
    }
}
```

### 6.7 SchedulingConfigç±»è¡¥å……æ–¹æ¡ˆ

```java
package com.huawei.browsergateway.config;

import org.springframework.context.annotation.Configuration;
import org.springframework.scheduling.annotation.EnableScheduling;

@Configuration
@EnableScheduling
public class SchedulingConfig {
    // å®šæ—¶ä»»åŠ¡å·²é€šè¿‡@EnableSchedulingå¯ç”¨
}
```

---

## ä¸ƒã€å®æ–½æ£€æŸ¥æ¸…å•

### 7.1 é…ç½®ç±»åˆ›å»ºæ£€æŸ¥

- [ ] åˆ›å»ºBrowserGatewayConfigç±»ï¼ˆæ›¿ä»£åŸConfigï¼‰
- [ ] åˆ›å»ºChromeConfigç±»
- [ ] åˆ›å»ºReportConfigç±»
- [ ] åˆ›å»ºTcpConfigç±»
- [ ] åˆ›å»ºWebsocketConfigç±»ï¼ˆåŒ…å«å‚æ•°ï¼‰
- [ ] åˆ›å»ºDataTrackerConfigç±»ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] æ›´æ–°SchedulingConfigç±»

### 7.2 é…ç½®é¡¹è¡¥å……æ£€æŸ¥

- [ ] è¡¥å……browsergw.chrome.record-extension-id
- [ ] è¡¥å……browsergw.report.control-tls-endpoint
- [ ] è¡¥å……browsergw.report.media-tls-endpoint
- [ ] è¡¥å……browsergw.tcp.address
- [ ] è¡¥å……browsergw.tcp.control-tls-port
- [ ] è¡¥å……browsergw.tcp.media-tls-port
- [ ] è¡¥å……browsergw.tcp.enable-http
- [ ] è¡¥å……browsergw.websocket.boss
- [ ] è¡¥å……browsergw.websocket.worker

### 7.3 ä»£ç é€‚é…æ£€æŸ¥

- [ ] æ£€æŸ¥PluginManageImplå¯¹æ‰©å±•è·¯å¾„çš„ä¾èµ–
- [ ] æ£€æŸ¥ChromeSetImplå¯¹åª’ä½“ç«¯ç‚¹çš„ä¾èµ–
- [ ] æ£€æŸ¥UserChromeå¯¹è·¯å¾„çš„ä¾èµ–
- [ ] æ›´æ–°æ‰€æœ‰ä½¿ç”¨@Valueç›´æ¥æ³¨å…¥çš„åœ°æ–¹æ”¹ç”¨é…ç½®ç±»

---

## å…«ã€ç»“è®ºä¸å»ºè®®

### 8.1 å…³é”®å‘ç°

1. **æ ¸å¿ƒé…ç½®ç±»ç¼ºå¤±**ï¼šé‡å†™ä»£ç ç¼ºå°‘å­˜é‡ä»£ç çš„Configä¸»é…ç½®ç±»ï¼Œè¿™æ˜¯æœ€ä¸¥é‡çš„ç¼ºå¤±
2. **é…ç½®è¿ç§»ä¸å®Œæ•´**ï¼šéƒ¨åˆ†é…ç½®é¡¹å·²ç»åœ¨application.yamlä¸­å®šä¹‰ï¼Œä½†ç¼ºå°‘å¯¹åº”çš„é…ç½®ç±»ç®¡ç†
3. **è·¯å¾„ç®¡ç†ç¼ºå¤±**ï¼šé‡å†™ä»£ç æ²¡æœ‰ç»Ÿä¸€çš„è·¯å¾„ç®¡ç†æœºåˆ¶
4. **é…ç½®åˆ†æ•£**ï¼šé‡å†™ä»£ç çš„é…ç½®ä½¿ç”¨æ–¹å¼æ˜¯@Valueç›´æ¥æ³¨å…¥ï¼Œç¼ºå°‘å±‚çº§ç»“æ„

### 8.2 ä¼˜å…ˆçº§å»ºè®®

**é«˜ä¼˜å…ˆçº§**ï¼ˆå¿…é¡»è¡¥å……ï¼‰ï¼š
1. âœ… BrowserGatewayConfigç±»ï¼ˆè·¯å¾„ç®¡ç†æ ¸å¿ƒï¼‰
2. âœ… ChromeConfigç±»ï¼ˆrecord-extension-idï¼‰
3. âœ… ReportConfigç±»ï¼ˆTLSç«¯ç‚¹ï¼‰

**ä¸­ä¼˜å…ˆçº§**ï¼ˆå»ºè®®è¡¥å……ï¼‰ï¼š
4. âš ï¸ TcpConfigç±»ï¼ˆå®Œæ•´TCPé…ç½®ï¼‰
5. âš ï¸ WebsocketConfigå‚æ•°ï¼ˆçº¿ç¨‹é…ç½®ï¼‰

**ä½ä¼˜å…ˆçº§**ï¼ˆå¯é€‰è¡¥å……ï¼‰ï¼š
6. ğŸ”µ DataTrackerConfigç±»ï¼ˆæ•°æ®è¿½è¸ªï¼‰
7. ğŸ”µ å®Œæ•´SchedulingConfigç±»


### 8.4 é¢„æœŸæ•ˆæœ

è¡¥å……å®Œæ•´åï¼š
- âœ… é‡å†™ä»£ç é…ç½®åŠŸèƒ½ä¸å­˜é‡ä»£ç 100%å¯¹é½
- âœ… æ”¯æŒæ‰€æœ‰ç°æœ‰é…ç½®é¡¹
- âœ… é…ç½®ç®¡ç†æ›´åŠ æ¸…æ™°å’Œç»Ÿä¸€
- âœ… ä¾¿äºåç»­ç»´æŠ¤å’Œæ‰©å±•

---